# Jay Stack: Page Configuration (`page.conf.yaml`)

## Overview

The `page.conf.yaml` file allows you to define a page's headless component dependencies and configuration without requiring a `page.jay-html` template file. This is particularly useful for:

1.  **Headless CMS / Design Tool Integration:** When pages are generated by external tools (like Figma) that define the data structure (`jay-contract`) and dependencies but haven't generated the view template yet.
2.  **Drafting:** Creating the structure of a page and its data requirements before implementing the UI.

**Note:** This configuration file is specifically for **headless components** only. It uses the same plugin resolution system as `<script type="application/jay-headless">` tags in jay-html files.

## File Location

The file must be named `page.conf.yaml` and placed directly inside the page's directory, alongside `page.jay-contract` (if it exists).

**Example Structure:**

```
src/pages/
  ├── home/
  │   ├── page.jay-contract
  │   └── page.conf.yaml     <-- Configuration file
  └── products/
      └── [id]/
          ├── page.jay-contract
          └── page.conf.yaml
```

## Configuration Schema

The file is a standard YAML file with the following structure:

```yaml
# List of headless components used on this page
used_components:
  - plugin: <plugin-name>
    contract: <contract-name>
    key: <data-binding-key>
```

### Fields

| Field             | Type  | Required | Description                                                               |
| ----------------- | ----- | -------- | ------------------------------------------------------------------------- |
| `used_components` | Array | No       | A list of headless components from installed plugins that this page uses. |

### Component Definition

Each item in `used_components` requires:

- **`plugin`**: The name of the plugin providing the headless component (e.g., `wix-jay-headless-store`).
- **`contract`**: The name of the contract within the plugin that defines the component's interface.
- **`key`**: The unique key used to identify this component's data in the page's data context.

This syntax matches exactly with `<script type="application/jay-headless">` tags in jay-html files, ensuring consistency across the Jay Stack.

## Precedence Rules

The Jay Stack Dev Server uses the following logic to determine a page's used headless components:

1.  **`page.jay-html` (Highest Priority):** If a `page.jay-html` file exists in the directory, the server parses it for `<script type="application/jay-headless">` tags. The `page.conf.yaml` file is **ignored** for component definitions in this case.
2.  **`page.conf.yaml`:** If `page.jay-html` is **missing**, the server reads `used_components` from `page.conf.yaml`.
3.  **Fallback:** If neither exists, the page is assumed to use no external headless components.

## Example

**File:** `src/pages/products/[id]/page.conf.yaml`

```yaml
used_components:
  # Use the product details headless component from the store plugin
  - plugin: wix-jay-headless-store
    contract: productPage
    key: product

  # Use the reviews headless component from a reviews plugin
  - plugin: jay-reviews-app
    contract: reviewList
    key: reviews
```

This configuration declares that the page requires headless components with contracts `productPage` (bound to `product`) and `reviewList` (bound to `reviews`). When the `getContracts` API is called, it will return the full contracts for these components as part of the page's requirements.

The plugin resolution follows the same logic as jay-html headless imports, supporting both local plugins (`src/plugins/`) and npm package plugins.
