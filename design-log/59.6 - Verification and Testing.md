# 59.6 - Verification and Testing (Vendor Agnostic Strategy)

## Context

With the move to the [Vendor Adapter Architecture](./59%20-%20Server-Side%20Figma%20Conversion%20and%20Bi-directional%20Sync.md), our testing strategy must cover both the generic API layer and the specific Vendor Adapters.

This log details the design for **Phase 6: Verification and Testing**.

## Goals

1.  **API Testing:** Verify the generic router handles valid/invalid vendor IDs correctly.
2.  **Adapter Testing:** Verify specific adapters (e.g., Figma) produce correct HTML from JSON fixtures.
3.  **Round-Trip Verification:** Ensure `Export -> Save -> Import` preserves data integrity.

## Strategies

### 1. Generic API Tests

- **Scope:** `jay-dev-server`
- **Tests:**
  - `POST /api/design/unknown/export` -> 400 Bad Request.
  - `POST /api/design/figma/export` -> Invokes FigmaAdapter.
  - `GET /api/design/figma/import` -> Returns file content.

### 2. Figma Adapter Tests

- **Scope:** `figma-adapter` (or `jay-dev-server/vendors/figma`)
- **Fixture-Based Testing:**
  - **Input:** `fixtures/button.figma.json` (Real export from plugin).
  - **Expected:** `fixtures/button.jay-html`.
  - **Test:** `expect(adapter.convert(input)).toBe(expected)`.

### 3. AI-Driven Fuzz Testing

- **Concept:** Use an LLM to generate thousands of valid `FigmaInterchangeDoc` JSONs based on the schema.
- **Goal:** Feed these into the Adapter to ensure it handles edge cases (e.g., deeply nested frames, huge numbers, missing optional fields) without crashing.

### 4. Visual Verification (Manual)

Since we can't easily automate visual diffs inside Figma:

1.  Create design in Figma.
2.  Export to Server.
3.  Import back to _new_ frame.
4.  Visually compare Original vs Imported.
