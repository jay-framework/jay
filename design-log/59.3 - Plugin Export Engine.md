# 59.3 - Editor Client Export (Figma Implementation)

## Context
In the [Vendor Adapter Architecture](./59%20-%20Server-Side%20Figma%20Conversion%20and%20Bi-directional%20Sync.md), each Editor Client (Plugin) is responsible for serializing its state into the Vendor Schema.

This log details the implementation for the **Figma Client Export**.

## Goals
1.  **Serialize:** Convert Figma `SceneNode` tree -> `FigmaInterchangeDoc`.
2.  **Transport:** Send payload to the generic API endpoint: `/api/design/figma/export`.

## Implementation Details

### 1. Serialization Logic (Figma Side)
*   **Mapper:** Implement a `nodeToInterchange(node)` function.
*   **Deep Traversal:** Recursively walk the tree.
*   **Data Extraction:**
    *   Visuals: Read `fills`, `strokes`, `effects` (and convert to schema types).
    *   Jay Data: Read `node.getPluginData(...)`.

### 2. API Communication
*   The plugin will perform a `fetch` request to the local Dev Server.
*   **Endpoint:** `http://localhost:[port]/api/design/figma/export`
*   **Payload:**
    ```json
    {
      "pageUrl": "home",
      "data": { ...FigmaInterchangeDoc... }
    }
    ```

### 3. Asset Handling (Images)
*   **Strategy:** Assets (Images, Vectors) must be uploaded separately to prevent bloating the JSON payload.
*   **Process:**
    1.  Plugin identifies all images in the design.
    2.  Plugin exports each image as PNG/SVG.
    3.  Plugin uploads each image to a separate endpoint (e.g., `/api/design/assets`).
    4.  Server saves the image and returns a reference (e.g., hash or path).
    5.  Plugin references these assets in the `FigmaInterchangeDoc` (e.g. `imageRef: "assets/hash.png"`) instead of embedding binary data.

## UX
*   **Publish Button:**
    *   State: "Idle" -> "Serializing..." -> "Uploading..." -> "Done".
    *   Error Handling: Show toast if Dev Server is unreachable.
