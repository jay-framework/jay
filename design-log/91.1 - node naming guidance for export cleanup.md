# Node Naming: What to Keep, What to Drop, and What to Fix

## Context

The reverse converter (jay-html -> figma.json) currently computes node names from HTML attributes. The forward converter (Figma -> jay-html in `jay-desktop-poc`) currently does NOT emit `data-name` or `data-figma-id` — it only sets a sanitized `id` attribute via `sanitizeHtmlId(name, id)`, which lowercases and mangles the original name, making it non-recoverable.

This means roundtrip naming is broken: original Figma names like "Hero Section" or "Frame 6" become generic "div" or "Frame" after the roundtrip.

---

## What names are FUNCTIONALLY required

Only 3 naming cases actually matter for the system to work:

### 1. Section name

The jay page section name (e.g., "Product Page"). Used for display in the plugin UI.

### 2. "Content" frame

`contractUiGenerator.ts` looks up the content frame by name:

```typescript
const contentFrame = jPageNode.children.find((child) => child.name === 'Content') as FrameNode;
```

This MUST be named "Content" exactly.

### 3. COMPONENT_SET / COMPONENT names

Variant property names are encoded in the component set and component names (e.g., `"status"`, `"status=ACTIVE"`). These are structural — they define variant properties.

---

## What names are NOT functionally required

All other node names (regular FRAMEs, TEXT nodes, GROUPs, VECTORs, RECTANGLEs) are purely cosmetic — they show up in Figma's layers panel but nothing in the system depends on them. The deserializer applies them (`if (doc.name) node.name = doc.name`) but the import works identically whether a frame is named "Hero Section" or "Frame".

---

## Recommendation for the export cleanup

### In the forward export (Figma -> jay-html):

**Option A (minimal — recommended):** Only emit `data-name` on nodes where the name is functionally required or meaningfully different from the default:

- The `<section>` element — always emit `data-name` with the section's Figma name
- COMPONENT_SET containers — the name carries variant property info
- Skip `data-name` for generic frames/text/vectors — these will get default names on reimport and that's fine

**Option B (full):** Emit `data-name` on every node. More complete for roundtrip fidelity, but adds noise to the jay-html for no functional benefit.

### In the reverse converter (jay-html -> figma.json):

Already handled correctly. The naming priority chain is:

1. `data-name` attribute (when present)
2. `aria-label`
3. `data-figma-type` capitalized (e.g., "frame" -> "Frame")
4. HTML tag name (e.g., "header", "nav")
5. Default: tag name or "Frame"

No changes needed here.

### In the tests:

The `node-naming` and `node-naming-detailed` fixtures validate the naming priority chain. If you go with Option A, no test changes needed — the reverse converter already handles both cases (with and without `data-name`).

If you want to strip names from the figma.json export entirely (for non-functional nodes), you'd need to:

1. Keep `name` on SECTION, "Content" frame, COMPONENT_SET, and COMPONENT nodes
2. Either omit `name` on everything else, or set a generic default
3. Update all fixture `expected.figma.json` files to match (remove specific names from non-functional nodes)

### Also worth noting: `data-figma-id`

The forward converter doesn't emit `data-figma-id` either. This is used by the reverse converter to preserve original Figma node IDs (for potential future layer merging/comparison). If you're cleaning up the export, emitting `data-figma-id` on every node would be more valuable than `data-name` — IDs are unique identifiers that enable future diffing, while names are just display labels.

---

## Summary

| What                          | Functionally required?           | Recommendation                        |
| ----------------------------- | -------------------------------- | ------------------------------------- |
| Section name                  | Yes                              | Always emit `data-name`               |
| "Content" frame name          | Yes (hardcoded lookup)           | Always name it "Content"              |
| COMPONENT_SET/COMPONENT names | Yes (variant properties)         | Always emit                           |
| All other node names          | No — cosmetic only               | Can omit from export, default is fine |
| `data-figma-id`               | Not yet, but valuable for future | Consider emitting on all nodes        |

---

## Implementation Results

Implemented Option A (minimal) in the forward converter.

### Changes made

**`packages/jay-stack/stack-cli/lib/vendors/figma/index.ts`:**

- Section elements now emit `data-name="${name}"` (the original Figma section name)
- Content frame (direct child of SECTION) now emits `data-name="${node.name}"` — preserves the "Content" name required by `contractUiGenerator.ts`

**`packages/jay-stack/stack-cli/lib/vendors/figma/converters/variants.ts`:**

- Variant container div now emits `data-name="${componentSetName || node.name}"` — preserves the component set name that encodes variant property structure

**Test fixtures updated:** All 5 expected.jay-html files updated to include `data-name` on content frames and variant containers.

**Tests:** 6/6 forward converter tests passing.
